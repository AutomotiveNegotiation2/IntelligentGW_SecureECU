<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>Vision Apps User Guide: ETHFW Demos</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Vision Apps User Guide
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ETHFW_DEMOS.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ETHFW Demos </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Ethernet firmware is integrated part of vision_apps and enabled by default. One can run all the OpenVx based demos alongside with Ethfw running on CPSW9G IP on J7ES EVM.</p>
<div class="image">
<img src="ethfw_demo_setup.png" alt="ethfw_demo_setup.png"/>
</div>
<h1><a class="anchor" id="autotoc_md181"></a>
Hardware Setup</h1>
<p>The below are required to run Ethfw</p><ul>
<li>J7ES EVM</li>
<li>GESI daughter card</li>
<li>QPENET (i.e. QSGMII) daughter card</li>
<li>Linux machine running DHCP server, this was tested on Ubuntu 18.04 but any version which supports hosting DHCP server would do</li>
<li>A client machine runnig Linux/Windows with a browser</li>
<li>A pair of network cables, connected as shown in the setup diagram above<ul>
<li>One cable connected to port8 on the GESI card and other end connected to Linux machine (i.e. the DHCP server)</li>
<li>Second cable connected to port3 on the GESI card and other end connected to client machine</li>
</ul>
</li>
<li>eDP cable connected to a eDP capable display monitor for running OpenVx demos</li>
<li>UART cable connected to main UART port on the J7ES EVM</li>
<li>12V power supply for the EVM</li>
<li>SD card</li>
</ul>
<h1><a class="anchor" id="autotoc_md182"></a>
Software Setup</h1>
<ul>
<li>Install and run a DHCP server on Ubuntu 18.04 machine by following the instructions here <a href="https://help.ubuntu.com/community/isc-dhcp-server">https://help.ubuntu.com/community/isc-dhcp-server</a> This machine will provide IP to R5F (Main MCU2_0), A72 and any client connected via GESI card.</li>
<li>Install and run a Plex media server on the same Ubuntu 18.04 machine by following the instructions here <a href="https://www.plex.tv/en-gb/media-server-downloads/">https://www.plex.tv/en-gb/media-server-downloads/</a></li>
<li><b>Optional:</b> The SDK includes a Linux base GUI control interface to enable/disable/configure features like VLAN, multicast, rate limiting, interVLAN routing and also to show the load of the CPU. The configuration GUI can be run on either of the Ubuntu laptops (PC1 or PC2) shown in the <a class="el" href="ETHFW_DEMOS.html">setup diagram</a> above and requires Python and other software components to be installed on the host PC. Please refer to the setup instructions provided in section <a href="https://software-dl.ti.com/jacinto7/esd/processor-sdk-rtos-jacinto7/latest/exports/docs/ethfw/docs/user_guide/demo_ethfw_combined_top.html#demo_ethfw_combined_prereq_python">Python3 and Pip3</a> of <a href="https://software-dl.ti.com/jacinto7/esd/processor-sdk-rtos-jacinto7/latest/exports/docs/ethfw/docs/user_guide/demo_ethfw_combined_top.html">Ethernet Firmware Demo user guide</a>. <blockquote class="doxtable">
<p><b>Note:</b> The GUI tool can be executed from either <b>PC 1</b> or <b>PC 2</b>, so Python and its dependencies must be installed only on the selected PC. </p>
</blockquote>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md183"></a>
Running the demo (Linux + RTOS) or (QNX + RTOS)</h1>
<ul>
<li>Build the application and related libraries as mentioned in <a class="el" href="BUILD_INSTRUCTIONS.html">Build Instructions</a></li>
<li>Open UART client like minicom on /dev/ttyUSB0 (instance 0) where Linux and OpenVx logs usually appear.</li>
<li>Power on the EVM and let the OS come up.</li>
<li>Login and navigate to /opt/vision_apps on linux and /ti_fs/vision_apps on QNX, run the ./vision_apps_init.sh script.</li>
<li>Upon sucessfull completion you should see Ethfw initialization logs and version as given below.</li>
</ul>
<div class="fragment"><div class="line">j7-evm login: root</div><div class="line">Last login: Mon Nov 29 14:43:33 UTC 2021</div><div class="line">root@j7-evm:~# source /opt/vision_apps/vision_apps_init.sh</div><div class="line">...</div><div class="line">...</div><div class="line">[MCU2_0]     17.235797 s: ETHFW: Init ... !!!</div><div class="line">[MCU2_0]     17.256561 s: ETHFW: Shared multicasts (software fanout):</div><div class="line">[MCU2_0]     17.256629 s:   01:00:5e:00:00:01</div><div class="line">[MCU2_0]     17.256683 s:   01:00:5e:00:00:fb</div><div class="line">[MCU2_0]     17.256729 s:   01:00:5e:00:00:fc</div><div class="line">[MCU2_0]     17.256772 s:   33:33:00:00:00:01</div><div class="line">[MCU2_0]     17.256815 s:   33:33:ff:1d:92:c2</div><div class="line">[MCU2_0]     17.256858 s:   01:80:c2:00:00:00</div><div class="line">[MCU2_0]     17.256900 s:   01:80:c2:00:00:03</div><div class="line">[MCU2_0]     17.256945 s: ETHFW: Reserved multicasts:</div><div class="line">[MCU2_0]     17.256981 s:   01:80:c2:00:00:0e</div><div class="line">[MCU2_0]     17.257029 s:   01:1b:19:00:00:00</div><div class="line">[MCU2_0]     17.257269 s: EnetMcm: CPSW_9G on MAIN NAVSS</div><div class="line">[MCU2_0]     17.268444 s: PHY 0 is alive</div><div class="line">[MCU2_0]     17.268525 s: PHY 3 is alive</div><div class="line">[MCU2_0]     17.268575 s: PHY 12 is alive</div><div class="line">[MCU2_0]     17.268612 s: PHY 15 is alive</div><div class="line">[MCU2_0]     17.268655 s: PHY 23 is alive</div><div class="line">[MCU2_0]     17.268948 s: EnetPhy_bindDriver: PHY 12: OUI:080028 Model:23 Ver:01 &lt;-&gt; &#39;dp83867&#39; : OK</div><div class="line">[MCU2_0]     17.269237 s: EnetPhy_bindDriver: PHY 0: OUI:080028 Model:23 Ver:01 &lt;-&gt; &#39;dp83867&#39; : OK</div><div class="line">[MCU2_0]     17.269530 s: EnetPhy_bindDriver: PHY 3: OUI:080028 Model:23 Ver:01 &lt;-&gt; &#39;dp83867&#39; : OK</div><div class="line">[MCU2_0]     17.269796 s: EnetPhy_bindDriver: PHY 15: OUI:080028 Model:23 Ver:01 &lt;-&gt; &#39;dp83867&#39; : OK</div><div class="line">[MCU2_0]     17.271513 s:</div><div class="line">[MCU2_0] ETHFW Version   : 0.02.00</div><div class="line">[MCU2_0]     17.271583 s: ETHFW Build Date: Dec  6, 2021</div><div class="line">[MCU2_0]     17.271616 s: ETHFW Build Time: 13:05:54</div><div class="line">[MCU2_0]     17.271643 s: ETHFW Commit SHA: 55d0bef1</div><div class="line">[MCU2_0]     17.271710 s: ETHFW: Init ... DONE !!!</div><div class="line">[MCU2_0]     17.271742 s: ETHFW: Remove server Init ... !!!</div><div class="line">[MCU2_0]     17.271916 s: CpswProxyServer: Virtual port configuration:</div><div class="line">[MCU2_0]     17.271981 s:   mpu_1_0 &lt;-&gt; Switch port 0: mpu_1_0_ethswitch-device-0</div><div class="line">[MCU2_0]     17.272031 s:   mcu_2_1 &lt;-&gt; Switch port 1: mcu_2_1_ethswitch-device-1</div><div class="line">[MCU2_0]     17.272076 s:   mpu_1_0 &lt;-&gt; MAC port 1: mpu_1_0_ethmac-device-1</div><div class="line">[MCU2_0]     17.272115 s:   mcu_2_1 &lt;-&gt; MAC port 4: mcu_2_1_ethmac-device-4</div><div class="line">[MCU2_0]     17.273139 s: CpswProxyServer: initialization completed (core: mcu2_0)</div><div class="line">[MCU2_0]     17.273207 s: ETHFW: Remove server Init ... DONE !!!</div><div class="line">[MCU2_0]     17.274312 s: Starting lwIP, local interface IP is dhcp-enabled</div><div class="line">[MCU2_0]     17.280756 s: Host MAC address: 70:ff:76:1d:92:c3</div><div class="line">[MCU2_0]     17.284536 s: [LWIPIF_LWIP] Enet LLD netif initialized successfully</div><div class="line">[MCU2_0]     17.316149 s: [LWIPIF_LWIP_IC] Interface started successfully</div><div class="line">[MCU2_0]     17.316220 s: [LWIPIF_LWIP_IC] NETIF INIT SUCCESS</div></div><!-- fragment --><ul>
<li>You should also see the IP addresses assigned to the R5F and A72 cores as shown below. Note that 'br4' IP is the IP address of the R5F core. The addresses shown in your logs may be different.</li>
</ul>
<div class="fragment"><div class="line">[MCU2_0]  SNo.      IP Address          MAC Address</div><div class="line">[MCU2_0]     22.675608 s: ------    -------------     -----------------</div><div class="line">[MCU2_0]     22.675643 s:   1       192.168.1.216     70:ff:76:1d:92:c1</div><div class="line">[MCU2_0]     22.677839 s: Function:CpswProxyServer_filterAddMacHandlerCb,HostId:0,Handle:a37e1074,CoreKey:38acb7e6, MacAddre0</div><div class="line">[MCU2_0]     22.679926 s: Function:CpswProxyServer_filterAddMacHandlerCb,HostId:0,Handle:a37e1074,CoreKey:38acb7e6, MacAddre0</div><div class="line">[MCU2_0]     25.274278 s: Added interface &#39;br4&#39;, IP is 192.168.1.219</div><div class="line">[MCU2_0]     25.287624 s: EthFw: TimeSync PTP enabled</div><div class="line">[MCU2_0]     25.293106 s: Rx Flow for Software Inter-VLAN Routing is up</div></div><!-- fragment --><p>You are now ready to run any of the OpenVx applications including DL applications using the SDK.</p>
<ul>
<li>To demostrate the switching capabily, on the server share a media file like a video file.</li>
<li>On the client machine open a browser and connect to the Plex server by typing the URL Eg. <code><a href="http://192.168.7.202:32400/web/index.html">http://192.168.7.202:32400/web/index.html</a></code></li>
<li>Once connection is established you can stream the video file via the J7ES CPSW9G running Ethfw in the background alongside other OpenVx demos.</li>
</ul>
<h2><a class="anchor" id="autotoc_md184"></a>
For QNX after running the vision_apps_init.sh script bring up the CPSW ethernet virtual driver as below,</h2>
<div class="fragment"><div class="line">slog2info -c</div><div class="line">slog2info -w &amp;</div><div class="line">io-pkt-v6-hc -d cpsw9g verbose=0x0</div><div class="line">dhclient -nw an0</div><div class="line">ifconfig -v</div></div><!-- fragment --><h1><a class="anchor" id="autotoc_md185"></a>
GUI Configurator Tool (Optional)</h1>
<ul>
<li>The instructions to run the GUI configurator tool are provided in section <a href="https://software-dl.ti.com/jacinto7/esd/processor-sdk-rtos-jacinto7/latest/exports/docs/ethfw/docs/user_guide/demo_ethfw_combined_top.html#ethfw_gui_tool_configuration">GUI Configurator Tool</a> of <a href="https://software-dl.ti.com/jacinto7/esd/processor-sdk-rtos-jacinto7/latest/exports/docs/ethfw/docs/user_guide/demo_ethfw_combined_top.html">Ethernet Firmware Demo user guide</a>.</li>
<li>Please follow these instructions and use the the IP address of the R5F core in the settings tab. The IP address assigned to the R5F core is shown as 'br4' IP in the console logs as mentioned earlier.</li>
</ul>
<h1><a class="anchor" id="autotoc_md186"></a>
Known Issues</h1>
<ul>
<li>The GESI card uses the same connector pins as infotainment card so only one of them can be connected</li>
<li>With Ethfw enabled by default, if infotainment board is connected it results in HDMI display corruption. eDP to HDMI adaptors also cannot be used with Ethfw enabled. To workaround this issue disable Ethfw if required or switch display to eDP.</li>
</ul>
<h1><a class="anchor" id="ETHFW_HOWTO_DISABLE"></a>
How to disable ETHFW</h1>
<ul>
<li>In file vision_apps_build_flags.mak, set BUILD_ENABLE_ETHFW?=no</li>
<li>Run "make vision_apps_scrub" prior to re-building</li>
<li>Note: Ethernet firmware must be disabled in order to use the HDMI display </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
